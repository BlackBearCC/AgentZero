# Agent记忆协同系统规范

## 记忆类型说明
### 固化记忆
- 说明：Agent预置的系统级知识库
- 来源：配置表
- 输出：直接注入系统prompt的固定段落
- 更新规则：仅通过配置表版本更新替换
- 使用规则：按照指定规则检索条目并注入系统prompt

### 动态记忆


### 短期记忆
- 说明：管理当前对话窗口的完整上下文（三级信息结构）
- 来源：原始对话记录+动态记忆摘要
- 输出结构：
  1. 背景概要（500 Token）
     - 模糊摘要：使用摘要模型生成的会话主题概要
     - 更新方式：每次对话窗口切换时重置
  2. 前情提要（300 Token）
     - 关键节点：保留最近3轮对话的精编版本
     - 更新方式：滚动保留核心决策点
  3. 完整上下文（1300 Token）
     - 原始记录：保留最近10轮完整对话
     - 更新方式：实时滚动更新
- 更新机制：
  - 滚动更新：每轮对话后自动重构三级结构
  - 信息压缩策略：
    - Level1：摘要模型压缩
    - Level2：关键信息提取
    - Level3：原始对话记录
- 使用规则：
  - 组合方式：背景概要 + 前情提要 + 最新对话组成prompt主体
  - 异常回退：当上下文丢失时，用前情提要+背景概要重建基础语境

### 长期记忆
- 说明：实时生成的对话记忆，记录当前会话的关键信息
- 来源：用户输入+AI响应+实体识别结果
- 输出：拼接后的字符串
- 更新机制：每10轮对话后增量更新
- 使用规则：
  1. 通过[重要度评分]保留前5轮核心信息
  2. 自动合并重复实体
  3. 超过长度时启动信息压缩

## 记忆协同规则
1. 优先级机制：
   - 固化记忆 > 动态记忆 > 长期记忆 > 短期记忆
   - 冲突时按优先级覆盖

2. 组合规则：
   - 固化记忆作为系统指令头
   - 动态记忆作为事件背景
   - 长期记忆作为知识参考
   - 短期记忆作为对话上下文

3. 更新触发条件：
   - 动态记忆：每轮对话后自动更新
   - 长期记忆：每日0点批量更新
   - 短期记忆：实时滚动更新

## 异常处理机制
1. 记忆冲突：记录冲突事件并人工复核
2. 记忆过载：启动LRU淘汰机制
3. 记忆丢失：通过对话日志重建短期记忆
